**Подготовка к теоретической части собеседования [SQL | Postgres]**

1) *Что такое SQL?*

-> SQL - стандартный язык, для взаимодействия с *реляционными* бд. Позволяет создавать и модифицировать структуру бд DDL
(Data Definition Language), управлять данными DML (Data Manipulation Language) и контролировать доступ к данным DCL
(Data Control Language).

Основные команды SQL:

* SELECT - для выборки данных
* INSERT - для вставки данных
* UPDATE - для изменения существующих записей
* DELETE - удаление записей
* CREATE TABLE - создание таблиц
* ALTER TABLE - изменение сущ. таблицы
* DROP TABLE - удаление таблицы

---

2) *В чем отличие между DDL, DML, DCL и TCL? Какие операции входят в каждую из групп?*

* **DDL (Data Definition Language)** - группа команд, которые используются для создания и изменения структуры объектов
  бд.
  Таких как: таблицы, представления и индексы.
  Наиболее известные команды: CREATE, ALTER, DROP.
* **DML (Data Manipulation Language)** - позволяет получать доступ к данным и манипулировать ими.
  Наиболее известные команды: SELECT, INSERT, UPDATE, DELETE.
* **DCL (Data Control Language)** - группа операций, которые используются для предоставления и отзыва привилегий
  пользователя бд.
  Наиболее известные: GRANT - предоставления доступа, REVOKE - отозвать ранее выданные права.
* **TCL (Transaction Control Language)** - используется для управления согласованностью данными и управления
  транзакциями.
  Наиболее частые команды: BEGIN/COMMIT - старт и фиксация изменений, ROLLBACK - откатывает изменения.

---

3) *Перечислите все типы связей таблиц в SQL.*

* **One-to-One** - связь, когда каждой записи из одной таблицы соответствует максимум одна запись из другой таблицы.
  В качестве примера: есть таблица сотрудники и таблица is_worker_student. Показывает, является ли сотрудник студентом.
  Необходимо чтоб внешний ключ из таблицы is_worker_student был уникальным. Ведь один сотрудник может быть студентом
  только 1 раз.
* **One-to-Many & Many-to-One** - одна запись в таблице связана с несколькими записями в другой таблице. Пример:
  Таблица пользователь и номера телефонов. У одного пользователя может быть *несколько* номеров, в то время
  как, номер может быть *только* у одного пользователя.
* **Many-to-Many** - связь, когда для определения отношения требуется несколько экзэмпляров с обеих сторон. Например:
  таблица сотрудников employer и должностей position. Работник может одновременно занимать несколько должностей
  (программист и администратор) в то же время в одной должности одновременно может находиться много сотрудников. Для
  описания такой связи необходимо заводить отдельную таблицу. [id, emp_id, position_id]
* **Self-Referencing Relationship** - тип связи, когда таблица ссылается на другую запись, находящуюся в ней самой.
  Обычно используется для иерархий. Например: сотрудник и его начальник (начальник это id другого пользователя в этой же
  таблице)

---

4) *Что такое СУБД?*

   -> СУБД - система управления базами данных. Программное обеспечение, которое взаимодействует с пользователем и самой
   бд для сбора и анализа данных. БД - это просто структурированные файлики с информацией на ПК. Сама БД не умеет
   ничего (быстро искать данные, делать сложные вычисления и т.д) без существования СУБД каждому разработчику
   самостоятельно с чистого листа пришлось бы прописывать всю эту логику.
   По своей сути СУБД это стандартизированный инструмент для более простой и эффективной работы с БД.

<u>Существует 2 типа СУБД:</u>

* Реляционные (PostgreSQL, MySQL) где данные хранятся в отношениях (таблицах).
* Нереляционные (Redis, MongoDB). Это документо ориентированные, графовые и ключ значение.

---

5) *В чем разница между базой данных и схемой?*

   -> БД - это хранилище данных, схема - это описание структуры этих данных. В SQL база данных - это набор связанных
   данных, которые хранятся в организованном структурированном виде. Обычно содержит несколько схем каждая из
   которых содержит свои таблицы, представления, процедуры и индексы.
   Схема позволяет логически сгруппировать связанные объекты и отделить их от других объектов. Что повышает
   безопасность, организованность и контроль доступа к данным.
   Пример: БД - это многоэтажный дом (панелька), который состоит из большого количества квартир (схем). Каждая квартира
   группирует связанных между собой людей (объекты бд) для повышения организованности, безопасности и контроля...

--- 

6) *Что такое нормализация и каковы ее преимущества?*

   -> Нормализация - это способ организации данных, цель избежать дублирования, избыточности и упростить организацию
   информации. В нормализованной базе нет повторяющихся данных, с ней проще работать и можно легко менять её структуру
   для разных задач. В процессе нормализации данные преобразуют, так чтоб они занимали меньше места, а поиск был быстрым
   и эффективным. Для этого создаются дополнительные таблицы, их в свою очередь связывают между собой.

<u>Преимущества</u>:

* Лучшая организация данных
* Таблицы меньших размеров
* Быстрый поиск информации
* Легко модифицировать
* Сокращение дублирования и избыточности данных
* Обеспечение согласованности данных после внесения изменений

---

7) *Какие уровни нормализации есть в SQL?*

<u>Существует 5 уровней нормализации БД:</u>

* *Первая нормальная форма.* Таблица находится в 1-ой нормальной форме если:
    - Каждый столбец содержит только атомарные (неделимые) значения
    - Нет дублирующихся строк
    - Нет повторяющися атрибутов с одинаковым смыслом
* *Вторая нормальная форма.*
    - Таблица находится в 1NF
    - Есть первичный ключ PK
    - Каждый неключевой столбец полностью функционально зависит от всего первичного ключа. Пример: есть таблица "Заказы"
      с полями "Идентификатор заказа", "Идентификатор товара", "Количество". Если "Идентификатор товара" и "Количество"
      зависят только от "Идентификатора заказа" тогда таблица во 2NF.
* *Третья нормальная форма.*
    - Таблица находится во 2NF
    - Каждый неключевой столбец не зависит от других неключевых столбцов, нет транзитивных (непрямых) зависимостей. Т.е
      неключевые атрибуты напрямую зависят только от PK.
* *Четвёртая нормальная форма.*
    - Таблица находится в 3NF
    - Устранены мультизависимости т.е если один ключ связан с несколькими независимыми наборами данных их следует
      разделить на отдельные таблицы. Пример: Student_id, course, hobby. Хобби и курс не зависят друг от друга.
      Следовательно следует разделить на 2 таблицы.
* *Пятая нормальная форма.*
    - Таблица находится в 4NF
    - Если несколько таблиц можно соединить в 1-у при помощи JOIN и нет избыточности и не теряется информация.

---

8) *В чем разница между типом данных CHAR и VARCHAR в SQL?*

   -> В CHAR хранятся строковые данные фиксированной длинны. Например если создать CHAR(5) и сохранить слово "cat" то
   оставшиеся символы будут заполнены space. В то время как VARCHAR(5) может хранить строку произвольной длины до 5
   символов.

---

9) *Как вычислить разницу между двумя датами в SQL?*

   -> select extract(day from 'DATE_A'::timestamp - 'DATE_B'::timestamp); Вроде как нет оператора DATEDIFF!

---

10) *Что такое индексы в SQL? Зачем они нужны?*

    -> Индексы - это структуры данных, которые создаются на столбцах таблицы и используются для ускорения выполнения
    запросов к бд. Чаще всего используются для более быстрого поиска данных. Индексы сортируют и организуют информацию в
    таблицах.
    Создание слишком большого количества индексов может негативно влиять на производительность т.к увеличивается время
    на изменения индекса при изменении исходной таблицы.

При помощи оптимизатора запросов бд выбирает оптимальный путь для получения данных. Она может как использовать так и не
использовать индекс.
Лучше всего использовать индексы на хранилищах данных которые планово изменяются в определённое время чтоб не
перегружать базу перестройкой индекса.

- Кластеризованный индекс - использует PK для структуризации данных в таблице. Чаще всего создаётся по умолчанию при
  определении ключа.
- Некластеризованный индекс нужен для того чтоб применять индексирование к неключевым столбцам. Такие индексы требуют
  явного определения. Они храняться в отдельном месте от данных.

Лучше не использовать индексирование если:
a) Таблица маленькая
b) Частые операции insert/update
c) Много null значений

---

11) *Какие виды индексов существуют в PostgreSQL?*

    -> Самые часты алгоритмы индексирования:

* **B-tree** - это структура самобалансирующегося дерева. Каждый узел содержит ключи и указатели на дочерние узлы.
  Хранение данных в иерархической структуре. Главное преимущество - минимизация операций ввода вывода потому что все
  узлы-листья находятся на одном уровне. Недостатки: излишняя трата ресурсов, медленные обновления, сложные алгоритмы
  для работы с B-tree.
  `CREATE INDEX idx_name_b_tree ON users (name);`
* **Hash** - индекс оптимизированного поиска по точным совпадениям [=]. Не поддерживает сравнение и работу с
  диапазонами <, >. Реже используется чем B-tree.
  `CREATE INDEX idx_name_hash ON users USING hash (name);`
* **GIN (Generalized Inverted Index)** - для индексации сложных объектов таких как массивы JSONB и
  полнотекстового поиска. Отдельно индексирует каждый элемент внутри объекта. Поэтому идеально подходит для поиска по
  отдельным элементам.
  `CREATE INDEX idx_jsonb_gin ON documents USING gin (data jsonb_path_ops);`
* **GiST (Generalized Search Tree** - используется для многомерных данных и работы с географическими объектами.
  `CREATE INDEX idx_gist ON locations USING gist (coordinates);`
* **BRIN (Block Range INdex)** - подходит для работы с большим количеством отсортированных данных потому что использует
  разделение по блокам. По этой причине используется меньше дискового пространства для данного индекса.

---

12) *Что такое индексация полнотекстового поиска в SQL и как она работает?*

    -> Индексация полнотекстового поиска - это механизм который позволяет быстро находить текст в больших объемах
    данных.
    Создаётся индекс GIN -> Текст разбивается на слова. При этом удаляются всё что не имеет смысла для поиска (предлоги,
    союзы) -> Индекс хранит ссылки на строки или позиции слов в документе. Для хранения данных используются
    вектора [tsvector].

---

13) *Что такое представление (VIEW) в SQL и как оно используется?*

    -> Представления (view) - это "виртуальные таблицы", которые не хранят в себе данные. Представление само по себе
    хранит запрос на выборку данных из настоящих отношений. Каждый раз когда делается запрос к представлению он
    подменяется на запрос который его описывает.

    Существуют материализованные представления. Они действительно хранят в себе информацию из исходных таблиц. Обычно
    они более быстрые но во первых их необходимо периодически самостоятельно обновлять с
    помощью `REFRESH MATERIALIZED VIEW` во вторых поддерживаются не во всех DB.

    `CREATE VIEW some_name AS SELECT ...;`

<u>Используются для:</u>

- Ограничения доступа к данным
- Псевдонимы для сложных запросов (под капотом выполняют группировки и расчёты агрегаций)
- Для соблюдения политики безопасности. Не нужно давать некоторым пользователям доступ ко всем данным из таблиц.
  Достаточно части данных которая может отображаться в представлениях.

---

14) *В чём отличие DELETE от TRUNCATE?*
    - DELETE для удаления [1 или нескольких записей]. TRUNCATE удаляет все данные из отношения
    - DELETE - это DML команда. TRUNCATE - это DDL команда
    - TRUNCATE работает быстрее

---

15) *В чём разница между операторами UNION и UNION ALL?*

    - UNION объединяет результат 2-х выборок данных причём удаляются дублирующие строки. Чем-то похож на оператор + над
      множествами.
    - UNION ALL объединяет результат 2-х выборок при этом оставляет все дублирующие строки. В результате получается всё
      что было в 1-м множестве и всё что было во 2-м множестве.

--- 

16) *Объясните функцию COALESCE в SQL*

    -> Ф-ия принимает несколько аргументов/столбцов/выражений и возвращает результат первого отличного от null
    выражения. В случае если все переданные аргументы = null ф-ия верёт null. Особенно полезна при работе со столбцами в
    которых могут быть null значения.

--- 

17) *Объясните оператор LIKE и его использование*

    -> Оператор используется для сравнения строк с некоторым заданным шаблоном строки. В шаблоне символ _ означает один
    любой символ а % произвольное количество любых символов.

---

18) *В чём разница между NATURAL JOIN и CROSS JOIN?*

    -> CROSS JOIN выполняет соединение таблиц на основе декартового произведения. Т.е для каждый записи из первой
    таблицы ставится в соответствие запись из 2-ой. При этом столбцы с одинаковым названием сохранятся.
    NATURAL JOIN выполнит соедиение на основании столбцов с одинаковым названием и типом данных. В результате склейки мы
    получим таблицы где сохранится только одна копия каждого общего столбца и все остальные атрибуты из обоих отношений.

--- 

19) *Cмысл всех букв в аббревиатуре ACID?*

    -> ACID - это набор правил (требований) которым должна удовлетворять транзакция.

- A - atomicy [атомарность] Каждая транзакция выполняется полностью или не выполняется совсем. Всё или ничего.
- C - consistency [согласованность] После того как транзакция совершилась т.е добралась до состояния EOT (end of
  transaction) не должна нарушаться консистентность/ограничения бд. Например если есть таблица пользователей и номеров
  телефонов не должна возникать ситуация когда произошёл INSERT INTO phone и не создался пользователь которому он
  принадлежит.
- I - isolation [изолированность] Каждая транзакция не должна влиять на работу параллельно запущенных транзакций. Для
  этого используют механизм блокировок и версионирование.
- D - durability [долговечность] Пользователь после того как транзакция завершилась должен быть уверен в том что его
  изменения сохранены и будут надёжно храниться даже в случае непредвиденной ошибки.

---

20) *Что такое транзакция в SQL и какими свойствами она должна обладать?*

    -> Транзакция - блок из нескольких SQL запросов, которые объединены в атомарную единицу. Либо все одновременно
    выполняются либо отменяются в случае ошибки.

---

21) *В чём разница между SAVEPOINT, COMMIT и CHECKPOINT?*

    -> SAVEPOINT находится на уровне транзакции. Позволяет частично откатываться внутри транзакции до определённой
    точки.

    -> COMMIT на уровне транзакции сохраняет все изменения в бд.

    -> CHECKPOINT на уровне бд записывает журнал транзакций из памяти на диск для управления восстановлением в случае
    сбоев.

---

22) *Какие аномалии вам известны при работе нескольких транзакций?*

    -> Потерянная запись. Например: счёт содержит 500 условных рублей. User_1 открыл транзакцию и списал -300руб. User_2
    открыл транзакцию и добавил на счёт +300руб при этом транзакция 2-го завершилась раньше 1-го. Получили на счёте 800р
    хотя должно было стать 500р. Запись первого потерялась! Кто последний записал того и тапки.

    -> Грязное чтение. Например: user_1 открыл транзакцию и списал со счёта -300руб. В этот момент user_2 запросил
    данные о счёте и получил 200руб при этом 1-ый решил откатить транзакцию т.е на счёте всё так же 500руб.

    -> Повторимое чтение. Например: user_1 строит отчёт по всей таблице min(col_1) в это время user_2 обновляет часть
    данных. Затем user_1 вычисляет max(col_2). Произошла ситуация когда 1-ый раз данные считались когда таблица была в
    одном состоянии а 2-ой раз когда уже в другом т.е с изменёнными данными!

    -> Эффект фантома. Точно такой же как и повторимое чтение только данные не обновляются а добавляются или удаляются
    вторым пользователем.

---

23) *Что такое процедура?*  
    Процедура - это скомпилированный набор инструкций который хранится в базе и может быть вызван при необходимости.
    Основное преимущество заключается в том что уменьщается кол-во дублирования в коде и более быстрое исполнение т.к
    процедуры компилируются один раз. Также повышается безопасность потому что они хранятся в бд и выдача доступов к ним
    более строгое чем для обычных запросов.

    Для вызова используется `CALL schema.procedure_name();`

---

24) *Что такое триггеры?*  
    Триггеры - это разновидность процедур которые предназначены для автоматического выполнения до или после изменения
    данных в базе. Позволяют выполнять код в момент вставки обновления или удаления информации.

---

25) *Что такое подзапрос?*  
    Подзапрос - это блок кода внутри другого запроса. В подзапросе внешний запрос называется основным а внутренний
    подзапросом. Подзапрос всегда вычисляется первым. Их можно использовать вместе с операторами IN <, >, = и т.д

---

26) *Что делает команда EXPLAIN в SQL?*

    -> Данная команда позволяет показать то в какой последовательности будет исполняться запрос и какие шаги будет
    выполнять субд для получения соответствующего результата. При этом сам запрос выполняться не будет!
    Используется для оптимизации сложных SQL запросов.

    -> Также существует команда EXPLAIN ANALYZE - которая делает всё то же самое что и EXPLAIN только дополнительно ещё
    и исполняет сам запрос и показывает предположительные резултаты и настоящие. Результат самого запроса не
    возвращается!

---

27) *UNION, MINUS, INTERSECT для чего нужны данные команды?*
    - UNION используется для объединения множеств. Подобна сумме
    - MINUS используется для получения значений только из одного множества за вычетом пересечений с другим. Подобие -
    - INTERSECT получить только пересечение 2-х множеств. Подобие *

---

28) *Что такое оконная функция?*

    -> Оконная функция - это функция которая работает с выделенным набором строк. Производит на них некоторые вычисления
    и результат записывает в соседнем столбце на против соответствующей строки.

    Партиция - это набор строк указанных для оконной ф-ии по одному из столбцов используемых в качестве группировки.

---

29) *Что вы можете сказать о WAL (ведение журнала с опережением записи)?*

    -> WAL (Write-ahead logging) - это механизм для обеспечения надёжности данных. Основная идея заключается в том что
    данные изначально записываются в лог файл на диске и только потом в файл с данными в базе. Это сводит к минимуму
    риск потери данных.

    Преимущества:
    1) Надёжность. В случае внезапного отключения сервера данные можно будет восстановить из этого журнала.
    2) Производительность. Большие операции можно записывать в основную базу в часы минимальной нагрузки.

    Из минусов можно выделить большой объём дискового пространства необходимый для хранения этой информации.

---

30) *Как запустить, перезапустить или остановить сервер PostgreSQL в Linux?*  
    - `systemctl status postgresql` - узнать текущее состояние сервера базы данных
    - `service postgresql start` - запустить сервер
    - `service postgresql restart` - перезапустить сервер
    - `service postgresql stop` - остановить сервер

---

31) *Что такое OLAP и OLTP системы?*  
    - OLAP - система аналитической обработки больших объёмов данных. Позволяет быстро (практически в режиме реального
      времени) анализировать огромное кол-во данных из разных источников и баз данных. Используется топ менеджментом
      крупных компаний для анализа текущей ситуации и принятия верных решений.
    - OLTP - система обработки большого количества транзакций в реальном времени.

---

32) *Что такое партиционирование базы данных?*

    -> Партиционирование - это процесс при котором одна большая таблица разделяется на множество связанных между
    собой таблиц (партиций). По факту мы как пользователь видим одно отношение логическую сущность но под капотом она
    представляет множетсво партиций. Это делается для того чтоб повысить скорость выполнения запросов. При таком
    раскладе оптимизатор запросов будет знать в какую партицию нужно идти за данными вследствие это мы будем
    быстро получать результат.

    Партиции - это разделы таблицы которые хранят данные соответствующие определённому критерию.

---

33) *Что такое шардирование/шардинг базы данных?*

    -> Шардирование - это процесс при котором данные в таблице разделяются на несколько частей и распределяются по
    полностю аналогичным таблицам которые расположены на разных серверах. Это позволяет повысить производительность и
    увеличить объём самой таблицы т.к они физически находятся на разных серверах.

    Если коротко то это хранение одной таблицы на разных серверах по частям.